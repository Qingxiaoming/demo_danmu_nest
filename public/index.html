<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>----</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/player.css">
</head>
<body>
    <div id="draggable-gif-container" class="draggable-gif">
        <img src="./-klbw3Qjzp-691xZbT1kSdw-dw.gif" alt="可拖动GIF" height="100">
    </div>
    <h1></h1>
    <div class="auth-container">
        <div class="login-container auth-element">
            <form id="login-form" onsubmit="return false;">
                <input type="password" id="login-password" name="password" placeholder="输入密码" autocomplete="current-password">
                <button type="submit" id="login-btn">Start</button>
                <button id="logout-btn" title="退出登录" class="auth-element" style="display: none; margin-left: 10px; background-color: #d9534f; color: white; border: none; border-radius: 3px; padding: 3px 8px; cursor: pointer;">退出</button>
            </form>
        </div>
        <div class="toggle-container">
            <div id="password-error" class="error-message auth-element"></div>
            <div id="login-status" class="status-message auth-element"></div>
        </div>
    </div>
    <div id="danmu-container"></div>
    <div class="add-danmu-btn-container" style="display: none;">
        <button id="toggle-btn" title="当前仅显示等待状态，点击显示全部状态"><i class="fas fa-eye-slash"></i></button>
        <button id="sort-btn" title="当前按时间升序排列，点击改为降序" style="display: none;"><i class="fas fa-sort-amount-down-alt"></i></button>
        <button id="add-danmu-btn" title="添加弹幕" class="auth-element"><i class="fas fa-plus"></i></button>
        <button id="settings-btn" title="设置" class="auth-element"><i class="fas fa-cog"></i></button>
    </div>
    <div id="server-error" class="error-message" style="display: none; color: red; font-weight: bold; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background-color: rgba(255, 255, 255, 0.8); padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);">服务器未连接</div>
    <div id="music-player" class="music-player">
        <div class="music-info">
            <img id="music-cover" class="music-cover" src="" alt="封面">
            <div class="music-details">
                <h3 id="music-title" class="music-title"></h3>
                <p id="music-artist" class="music-artist"></p>
            </div>
        </div>
        <div class="music-progress">
            <div id="music-progress-bar" class="music-progress-bar"></div>
        </div>
        <div class="music-lyrics" id="music-lyrics">
            <p class="current-lyric"></p>
        </div>
        <audio id="music-audio" style="display: none;"></audio>
    </div>
    
    <!-- 外部库 -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    
    <!-- 应用模块 -->
    <script src="js/utils.js"></script>
    <script src="js/socket.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/danmu.js"></script>
    <script src="js/player.js"></script>
    <script src="js/ui.js"></script>
    
    <!-- 初始化应用 -->
    <script>
        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化Socket连接
            window.socket_module.initSocket();
            
            // 初始化认证模块
            window.auth.initAuth();
            
            // 初始化弹幕模块
            window.danmu.initDanmu();
            
            // 初始化UI事件
            window.ui.initUIEvents();
            
            // 初始化可拖动GIF
            window.utils.initDraggableGif();

            // 初始化播放器
            window.player.initPlayer(); // 确保调用初始化播放器
        });
    </script>
</body>
</html>